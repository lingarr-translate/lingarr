FROM node:20.10.0-slim AS client# Prepare ClientCOPY ./Lingarr.Client/ /ClientWORKDIR /ClientRUN npm installRUN npm run buildFROM mcr.microsoft.com/dotnet/aspnet:8.0 AS baseWORKDIR /app# change UID/GID dynamicRUN apt-get update && apt-get install -y gosuCOPY entrypoint.sh /usr/local/bin/entrypoint.shRUN chmod +x /usr/local/bin/entrypoint.shFROM mcr.microsoft.com/dotnet/sdk:8.0 AS buildARG BUILD_CONFIGURATION=ReleaseWORKDIR /srcCOPY ["Lingarr.Server/Lingarr.Server.csproj", "Lingarr.Server/"]RUN dotnet restore "./Lingarr.Server/./Lingarr.Server.csproj"COPY . .WORKDIR "/src/Lingarr.Server"COPY --from=client /Client/dist/ ./wwwrootRUN dotnet build "./Lingarr.Server.csproj" -c $BUILD_CONFIGURATION -o /app/buildFROM build AS publishARG BUILD_CONFIGURATION=ReleaseRUN dotnet publish "./Lingarr.Server.csproj" -c $BUILD_CONFIGURATION -o /app/publish /p:UseAppHost=falseFROM base AS finalWORKDIR /appCOPY --from=publish /app/publish .COPY --from=base /usr/bin/gosu /usr/bin/gosuENV ASPNETCORE_HTTP_PORTS=9876ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]CMD ["dotnet", "Lingarr.Server.dll"]